<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="doc2go">
    <link href="../../../../../_/css/main.css" rel="stylesheet" />
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../../_/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../../_/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../../_/icons/favicon-16x16.png">
    <link rel="shortcut icon" href="../../../../../_/icons/favicon.ico"><title>job</title>
</head>
  <body>
    <nav>
        <a href="../../../..">github.com</a>/<a href="../../..">dmdavis</a>/<a href="../..">ijr</a>/<a href="..">pkg</a>/job<span class="navbar-right">
          <a href="../../../../..">Root</a> | <a href="#pkg-index">Index</a></span>
      </nav>
    <main><h2 id="pkg-overview">package job</h2>
<pre class="chroma"><span class="kn">import</span> <span class="s">&#34;github.com/dmdavis/ijr/pkg/job&#34;</span></pre>
<p>Package job contains the <a href="#Job">Job</a>, <a href="#Server">Server</a>, and <a href="#ExecutionStateStore">ExecutionStateStore</a> structs
and code.
<h3 id="pkg-index">Index</h3>
<ul>
  <li>
      <a href="#ExecAttributes">type ExecAttributes</a>
      </li>
  <li>
      <a href="#ExecutionState">type ExecutionState</a>
      </li>
  <li>
      <a href="#ExecutionStateStore">type ExecutionStateStore</a>
      <ul>
          <li><a href="#NewExecutionStateStore">func NewExecutionStateStore() *ExecutionStateStore</a></li>
          <li><a href="#ExecutionStateStore.Add">func (s *ExecutionStateStore) Add(id uuid.UUID, jobState ExecutionState)</a></li>
          <li><a href="#ExecutionStateStore.Delete">func (s *ExecutionStateStore) Delete(id uuid.UUID)</a></li>
          <li><a href="#ExecutionStateStore.List">func (s *ExecutionStateStore) List() map[uuid.UUID]ExecutionState</a></li>
          </ul>
      </li>
  <li>
      <a href="#Job">type Job</a>
      <ul>
          <li><a href="#Job.GetJobId">func (j *Job) GetJobId() string</a></li>
          <li><a href="#Job.Start">func (j *Job) Start(attributes ExecAttributes, wg *sync.WaitGroup) error</a></li>
          <li><a href="#Job.Stop">func (j *Job) Stop() error</a></li>
          </ul>
      </li>
  <li>
      <a href="#Server">type Server</a>
      <ul>
          <li><a href="#Server.DeleteFolder">func (s Server) DeleteFolder(context.Context, *rootfs.DeleteFolderRequest) (*rootfs.DeleteFolderResponse, error)</a></li>
          <li><a href="#Server.ListFolders">func (s Server) ListFolders(context.Context, *rootfs.ListFoldersRequest) (*rootfs.ListFoldersResponse, error)</a></li>
          <li><a href="#Server.ListJobs">func (s Server) ListJobs(context.Context, *job.ListJobsRequest) (*job.ListJobsResponse, error)</a></li>
          <li><a href="#Server.StartJob">func (s Server) StartJob(context.Context, *job.StartRequest) (*job.StartResponse, error)</a></li>
          <li><a href="#Server.StopJob">func (s Server) StopJob(context.Context, *job.JobIdentifier) (*job.StopResponse, error)</a></li>
          <li><a href="#Server.StreamJobOutput">func (s Server) StreamJobOutput(*job.JobIdentifier, job.JobService_StreamJobOutputServer) error</a></li>
          <li><a href="#Server.Upload">func (s Server) Upload(context.Context, *rootfs.UploadRequest) (*rootfs.UploadResponse, error)</a></li>
          </ul>
      </li>
  </ul><h3 id="pkg-types">Types</h3>
  <h3 id="ExecAttributes">type ExecAttributes</h3>
    <pre class="chroma"><span class="kd">type</span> <span class="nx">ExecAttributes</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// CPUShares is a number representing the proportion of CPU shares the job has.
</span><span class="c1"></span>	<span id="ExecAttributes.CPUShares"><span class="nx">CPUShares</span></span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a>
	<span class="c1">// MemoryLimit represents the memory limit of a job in bytes.
</span><span class="c1"></span>	<span id="ExecAttributes.MemoryLimit"><span class="nx">MemoryLimit</span></span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a>
	<span class="c1">// DiskReadIOLimit represents the limit on disk read I/O for a job in IOPS per second.
</span><span class="c1"></span>	<span id="ExecAttributes.DiskReadIOLimit"><span class="nx">DiskReadIOLimit</span></span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a>
	<span class="c1">// DiskWriteIOLimit represents the limit on disk write I/O for a job in IOPS per second.
</span><span class="c1"></span>	<span id="ExecAttributes.DiskWriteIOLimit"><span class="nx">DiskWriteIOLimit</span></span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a>
	<span class="c1">// RootFS is name of the root file system folder the job command will execute on.
</span><span class="c1"></span>	<span id="ExecAttributes.RootFS"><span class="nx">RootFS</span></span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a>
	<span class="c1">// JobCommand represents the command to be executed by a Job.
</span><span class="c1"></span>	<span id="ExecAttributes.JobCommand"><span class="nx">JobCommand</span></span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a>
<span class="p">}</span></pre>
    <p>ExecAttributes holds the execution settings for a job initiated with
Job.Start.
<h3 id="ExecutionState">type ExecutionState</h3>
    <pre class="chroma"><span class="kd">type</span> <span class="nx">ExecutionState</span> <span class="kd">struct</span> <span class="p">{</span>
	<span id="ExecutionState.RootFS"><span class="nx">RootFS</span></span>     <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a>
	<span id="ExecutionState.JobCommand"><span class="nx">JobCommand</span></span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a>
<span class="p">}</span></pre>
    <p>ExecutionState contains information about a running job.
<h3 id="ExecutionStateStore">type ExecutionStateStore</h3>
    <pre class="chroma"><span class="kd">type</span> <span class="nx">ExecutionStateStore</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// contains filtered or unexported fields
</span><span class="c1"></span><span class="p">}</span></pre>
    <p>ExecutionStateStore represents a basic in-memory data store for the
execution state of running jobs. It provides methods to add, delete, and list
job state and is safe to call from multiple goroutines.
<h4 id="NewExecutionStateStore">func NewExecutionStateStore</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="nf">NewExecutionStateStore</span><span class="p">()</span> <span class="o">*</span><a href="#ExecutionStateStore"><span class="nx">ExecutionStateStore</span></a></pre>
  <p>NewExecutionStateStore returns a new instance of ExecutionStateStore.
<h4 id="ExecutionStateStore.Add">func (*ExecutionStateStore) Add</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><a href="#ExecutionStateStore"><span class="nx">ExecutionStateStore</span></a><span class="p">)</span> <span class="nf">Add</span><span class="p">(</span><span class="nx">id</span> <a href="https://pkg.go.dev/github.com/google/uuid"><span class="nx">uuid</span></a><span class="p">.</span><a href="https://pkg.go.dev/github.com/google/uuid#UUID"><span class="nx">UUID</span></a><span class="p">,</span> <span class="nx">jobState</span> <a href="#ExecutionState"><span class="nx">ExecutionState</span></a><span class="p">)</span></pre>
  <p>Add adds a new job execution state to the ExecutionStateStore by associating
the provided `id` with the given `jobState`.
<h4 id="ExecutionStateStore.Delete">func (*ExecutionStateStore) Delete</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><a href="#ExecutionStateStore"><span class="nx">ExecutionStateStore</span></a><span class="p">)</span> <span class="nf">Delete</span><span class="p">(</span><span class="nx">id</span> <a href="https://pkg.go.dev/github.com/google/uuid"><span class="nx">uuid</span></a><span class="p">.</span><a href="https://pkg.go.dev/github.com/google/uuid#UUID"><span class="nx">UUID</span></a><span class="p">)</span></pre>
  <p>Delete removes the ExecutionState with the specified `id` from the store.
<h4 id="ExecutionStateStore.List">func (*ExecutionStateStore) List</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><a href="#ExecutionStateStore"><span class="nx">ExecutionStateStore</span></a><span class="p">)</span> <span class="nf">List</span><span class="p">()</span> <span class="kd">map</span><span class="p">[</span><a href="https://pkg.go.dev/github.com/google/uuid"><span class="nx">uuid</span></a><span class="p">.</span><a href="https://pkg.go.dev/github.com/google/uuid#UUID"><span class="nx">UUID</span></a><span class="p">]</span><a href="#ExecutionState"><span class="nx">ExecutionState</span></a></pre>
  <p>List acquires a read lock before returning the `store` field of the
ExecutionStateStore instance, which is a map of UUID keys to ExecutionState
values.
<h3 id="Job">type Job</h3>
    <pre class="chroma"><span class="kd">type</span> <span class="nx">Job</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// OutputSender sends job command STDOUT and STDERR text via OutputSender.Send().
</span><span class="c1"></span>	<span id="Job.OutputSender"><span class="nx">OutputSender</span></span> <a href="../api"><span class="nx">api</span></a><span class="p">.</span><a href="../api#OutputSender"><span class="nx">OutputSender</span></a>
	<span class="c1">// contains filtered or unexported fields
</span><span class="c1"></span><span class="p">}</span></pre>
    <p>Job represents an executable job.
<h4 id="Job.GetJobId">func (*Job) GetJobId</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">j</span> <span class="o">*</span><a href="#Job"><span class="nx">Job</span></a><span class="p">)</span> <span class="nf">GetJobId</span><span class="p">()</span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a></pre>
  <p>GetJobId returns the UUID of the running job.
<h4 id="Job.Start">func (*Job) Start</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">j</span> <span class="o">*</span><a href="#Job"><span class="nx">Job</span></a><span class="p">)</span> <span class="nf">Start</span><span class="p">(</span><span class="nx">attributes</span> <a href="#ExecAttributes"><span class="nx">ExecAttributes</span></a><span class="p">,</span> <span class="nx">wg</span> <span class="o">*</span><a href="https://pkg.go.dev/sync"><span class="nx">sync</span></a><span class="p">.</span><a href="https://pkg.go.dev/sync#WaitGroup"><span class="nx">WaitGroup</span></a><span class="p">)</span> <a href="https://pkg.go.dev/builtin#error"><span class="kt">error</span></a></pre>
  <p>Start starts the job with the supplied ExecAttributes and an optional
sync.WaitGroup wg. Set wg to nil if you don&apos;t need to wait on completion.
<h4 id="Job.Stop">func (*Job) Stop</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">j</span> <span class="o">*</span><a href="#Job"><span class="nx">Job</span></a><span class="p">)</span> <span class="nf">Stop</span><span class="p">()</span> <a href="https://pkg.go.dev/builtin#error"><span class="kt">error</span></a></pre>
  <p>Stop kills the job process.
<h3 id="Server">type Server</h3>
    <pre class="chroma"><span class="kd">type</span> <span class="nx">Server</span> <span class="kd">struct</span> <span class="p">{</span>
	<a href="../api/job"><span class="nx">job</span></a><span class="p">.</span><a href="../api/job#UnimplementedJobServiceServer"><span class="nx">UnimplementedJobServiceServer</span></a>
	<a href="../api/rootfs"><span class="nx">rootfs</span></a><span class="p">.</span><a href="../api/rootfs#UnimplementedRootFileServiceServer"><span class="nx">UnimplementedRootFileServiceServer</span></a>
	<span id="Server.RootFSBase"><span class="nx">RootFSBase</span></span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a>
<span class="p">}</span></pre>
    <p>Server serves the job and rootfs gRPC services.
<h4 id="Server.DeleteFolder">func (Server) DeleteFolder</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <a href="#Server"><span class="nx">Server</span></a><span class="p">)</span> <span class="nf">DeleteFolder</span><span class="p">(</span><a href="https://pkg.go.dev/context"><span class="nx">context</span></a><span class="p">.</span><a href="https://pkg.go.dev/context#Context"><span class="nx">Context</span></a><span class="p">,</span> <span class="o">*</span><a href="../api/rootfs"><span class="nx">rootfs</span></a><span class="p">.</span><a href="../api/rootfs#DeleteFolderRequest"><span class="nx">DeleteFolderRequest</span></a><span class="p">)</span> <span class="p">(</span><span class="o">*</span><a href="../api/rootfs"><span class="nx">rootfs</span></a><span class="p">.</span><a href="../api/rootfs#DeleteFolderResponse"><span class="nx">DeleteFolderResponse</span></a><span class="p">,</span> <a href="https://pkg.go.dev/builtin#error"><span class="kt">error</span></a><span class="p">)</span></pre>
  <p>DeleteFolder deletes a root files system sub-folder under RootFSPath.
<h4 id="Server.ListFolders">func (Server) ListFolders</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <a href="#Server"><span class="nx">Server</span></a><span class="p">)</span> <span class="nf">ListFolders</span><span class="p">(</span><a href="https://pkg.go.dev/context"><span class="nx">context</span></a><span class="p">.</span><a href="https://pkg.go.dev/context#Context"><span class="nx">Context</span></a><span class="p">,</span> <span class="o">*</span><a href="../api/rootfs"><span class="nx">rootfs</span></a><span class="p">.</span><a href="../api/rootfs#ListFoldersRequest"><span class="nx">ListFoldersRequest</span></a><span class="p">)</span> <span class="p">(</span><span class="o">*</span><a href="../api/rootfs"><span class="nx">rootfs</span></a><span class="p">.</span><a href="../api/rootfs#ListFoldersResponse"><span class="nx">ListFoldersResponse</span></a><span class="p">,</span> <a href="https://pkg.go.dev/builtin#error"><span class="kt">error</span></a><span class="p">)</span></pre>
  <p>ListFolders lists all root file system folders under RootFSPath.
<h4 id="Server.ListJobs">func (Server) ListJobs</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <a href="#Server"><span class="nx">Server</span></a><span class="p">)</span> <span class="nf">ListJobs</span><span class="p">(</span><a href="https://pkg.go.dev/context"><span class="nx">context</span></a><span class="p">.</span><a href="https://pkg.go.dev/context#Context"><span class="nx">Context</span></a><span class="p">,</span> <span class="o">*</span><a href="../api/job"><span class="nx">job</span></a><span class="p">.</span><a href="../api/job#ListJobsRequest"><span class="nx">ListJobsRequest</span></a><span class="p">)</span> <span class="p">(</span><span class="o">*</span><a href="../api/job"><span class="nx">job</span></a><span class="p">.</span><a href="../api/job#ListJobsResponse"><span class="nx">ListJobsResponse</span></a><span class="p">,</span> <a href="https://pkg.go.dev/builtin#error"><span class="kt">error</span></a><span class="p">)</span></pre>
  <p>ListJobs returns a list of all running jobs.
<h4 id="Server.StartJob">func (Server) StartJob</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <a href="#Server"><span class="nx">Server</span></a><span class="p">)</span> <span class="nf">StartJob</span><span class="p">(</span><a href="https://pkg.go.dev/context"><span class="nx">context</span></a><span class="p">.</span><a href="https://pkg.go.dev/context#Context"><span class="nx">Context</span></a><span class="p">,</span> <span class="o">*</span><a href="../api/job"><span class="nx">job</span></a><span class="p">.</span><a href="../api/job#StartRequest"><span class="nx">StartRequest</span></a><span class="p">)</span> <span class="p">(</span><span class="o">*</span><a href="../api/job"><span class="nx">job</span></a><span class="p">.</span><a href="../api/job#StartResponse"><span class="nx">StartResponse</span></a><span class="p">,</span> <a href="https://pkg.go.dev/builtin#error"><span class="kt">error</span></a><span class="p">)</span></pre>
  <p>StartJob is a method that starts a job with the given context and request.
It returns a StartResponse and an error.
<h4 id="Server.StopJob">func (Server) StopJob</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <a href="#Server"><span class="nx">Server</span></a><span class="p">)</span> <span class="nf">StopJob</span><span class="p">(</span><a href="https://pkg.go.dev/context"><span class="nx">context</span></a><span class="p">.</span><a href="https://pkg.go.dev/context#Context"><span class="nx">Context</span></a><span class="p">,</span> <span class="o">*</span><a href="../api/job"><span class="nx">job</span></a><span class="p">.</span><a href="../api/job#JobIdentifier"><span class="nx">JobIdentifier</span></a><span class="p">)</span> <span class="p">(</span><span class="o">*</span><a href="../api/job"><span class="nx">job</span></a><span class="p">.</span><a href="../api/job#StopResponse"><span class="nx">StopResponse</span></a><span class="p">,</span> <a href="https://pkg.go.dev/builtin#error"><span class="kt">error</span></a><span class="p">)</span></pre>
  <p>StopJob terminates a running job.
<h4 id="Server.StreamJobOutput">func (Server) StreamJobOutput</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <a href="#Server"><span class="nx">Server</span></a><span class="p">)</span> <span class="nf">StreamJobOutput</span><span class="p">(</span><span class="o">*</span><a href="../api/job"><span class="nx">job</span></a><span class="p">.</span><a href="../api/job#JobIdentifier"><span class="nx">JobIdentifier</span></a><span class="p">,</span> <a href="../api/job"><span class="nx">job</span></a><span class="p">.</span><a href="../api/job#JobService_StreamJobOutputServer"><span class="nx">JobService_StreamJobOutputServer</span></a><span class="p">)</span> <a href="https://pkg.go.dev/builtin#error"><span class="kt">error</span></a></pre>
  <p>StreamJobOutput streams command output from a running job.
<h4 id="Server.Upload">func (Server) Upload</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <a href="#Server"><span class="nx">Server</span></a><span class="p">)</span> <span class="nf">Upload</span><span class="p">(</span><a href="https://pkg.go.dev/context"><span class="nx">context</span></a><span class="p">.</span><a href="https://pkg.go.dev/context#Context"><span class="nx">Context</span></a><span class="p">,</span> <span class="o">*</span><a href="../api/rootfs"><span class="nx">rootfs</span></a><span class="p">.</span><a href="../api/rootfs#UploadRequest"><span class="nx">UploadRequest</span></a><span class="p">)</span> <span class="p">(</span><span class="o">*</span><a href="../api/rootfs"><span class="nx">rootfs</span></a><span class="p">.</span><a href="../api/rootfs#UploadResponse"><span class="nx">UploadResponse</span></a><span class="p">,</span> <a href="https://pkg.go.dev/builtin#error"><span class="kt">error</span></a><span class="p">)</span></pre>
  <p>Upload takes an UploadRequest and extracts the root file system archive in
UploadRequest.data to a subfolder Server.RootFSBase named with the value in
UploadRequest.folder_name.
</main>
    <hr>
    <footer>
      <small id="generated-by-footer">
        Generated with <a href="https://abhinav.github.io/doc2go/">doc2go</a>
      </small>
    </footer>
    <script src="../../../../../_/js/permalink.js"></script></body>
</html>
